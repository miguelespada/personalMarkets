<div class="panel panel-default market-statistic"> 
  <div class="panel-heading statistic-title">
    <div class="statistic-title-container">
      <%= market.decorate.link(market.decorate.formatted_market_name)%> 
      <span class="badge pull-right statistic-visit-count">
        <div class="visits-label">
          <%= t(:visits).capitalize %>
        </div>
        <div id="<%= market.public_id %>_visitsCount" class="visits-value">
        </div>
      </span>
    </div>
  </div>

  <div class="panel-body">
    <div id="<%= market.public_id %>_visitsChart" class="visits-chart">
    </div>
  </div>
</div>

<script type="text/javascript">
  Keen.onChartsReady(function() {
      var metric = new Keen.Metric("market_visit", {
          analysisType: "count"
      });
  
      metric.addFilter("market_id", "eq", "<%= market.public_id %>");
  
      metric.getResponse(function(response){
        $("#<%= market.public_id %>_visitsCount").html(response.result);
      });
  });
  
  Keen.onChartsReady(function() {
      var series = new Keen.Series("market_visit", {
          analysisType: "count",
          timeframe: "this_week",
          interval: "daily"
      });
  
      series.addFilter("market_id", "eq", "<%= market.public_id %>");
  
      series.draw(document.getElementById("<%= market.public_id %>_visitsChart"), {
          label: "<%= t(:visits_per_day_this_week) %>"
      });
  });
</script>

<style>
  .visits-chart{
    width:100% !important;
    text-align: center !important;
    overflow: auto;
  }
  .visits-chart>div{
    margin: 0 auto;
  }
  .statistic-title-container{
    width:600px;
    max-width: 100%;
    margin: 0 auto;
  }
</style>