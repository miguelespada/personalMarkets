<%= javascript_include_tag "attachinary" %>

<% required ||= false %>
<%= f.input :photo, as: :attachinary, required: required %>
<script>
$( document ).ready(function() {
  $('.attachinary-input').attachinary();

  $('.attachinary-input').fileupload({
      progressall: function (e, data) {
        $('#progress').removeAttr( 'style' );
        var progress = parseInt(data.loaded / data.total * 100, 10);
        try{
          if(progress >= 100){
            $("#progress").html("[Upload progress: DONE]");
            setTimeout(function() {
              $('#progress').fadeOut('slow');
            }, 1000); // <-- time in milliseconds
          }
          else{
            $("#progress").html("[Upload progress: " + progress + " %]");
          }
        }catch(ex){}
      },
      add: function(e, data) {
        if(data.originalFiles[0]['size'] > 1000000) {
            alert("Filesize is too big. Maximun size is 1 Mb");
        }
        else {
            data.submit();
        }
    }
  });

});
</script>